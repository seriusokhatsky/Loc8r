function formatDistance(){return function(a){var b,c;return a&&_isNumeric(a)?(a>1e3?(b=parseFloat(a/1e3),c="km"):(b=parseInt(a,10),c="m"),b+c):"?"}}!function(){function a(a,b){a.when("/",{templateUrl:"home/home.view.html",controller:"homeCtrl",controllerAs:"vm"}).when("/about",{templateUrl:"/common/view/genericText.view.html",controller:"aboutCtrl",controllerAs:"vm"}).when("/register",{templateUrl:"/auth/register/register.view.html",controller:"registerCtrl",controllerAs:"vm"}).when("/login",{templateUrl:"/auth/login/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).when("/location/:locationid",{templateUrl:"/locationDetail/locationDetail.view.html",controller:"locationDetailCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"}),b.html5Mode(!0)}angular.module("loc8rApp",["ngRoute","ngSanitize","ui.bootstrap"]),angular.module("loc8rApp").config(["$routeProvider","$locationProvider",a])}(),function(){function a(a,b,c){var d=this;d.pageHeader={title:"Loc8r",strapline:"Find places to work with wifi near you!"},d.sidebar={content:"Looking for wifi and a seat? Etc etc"},d.message="Checking your location",d.getData=function(a){var c=a.coords.latitude,e=a.coords.longitude;d.message="Searching for nearby places",b.locationByCoords(c,e).success(function(a){d.message=a.length>0?"":"No locations found nearby",d.data={locations:a}}).error(function(a){d.message="Sorry, something's gone wrong"})},d.showError=function(b){a.$apply(function(){d.message=b.message})},d.noGeo=function(){a.$apply(function(){d.message="Geolocation is not supported by this browser."})},c.getPosition(d.getData,d.showError,d.noGeo)}angular.module("loc8rApp").controller("homeCtrl",a),a.$inject=["$scope","loc8rData","geolocation"]}(),function(){function a(a,b){var c=this;c.pageHeader={title:"Create a new Loc8r account"},c.credentials={name:"",email:"",password:""},c.returnPage=a.search().page||"/",c.onSubmit=function(){return c.formError="",c.credentials.name&&c.credentials.email&&c.credentials.password?void c.doRegister():(c.formError="All fields required, please try again",!1)},c.doRegister=function(){c.formError="",b.register(c.credentials).error(function(a){c.formError=a}).then(function(){a.search("page",null),a.path(c.returnPage)})}}angular.module("loc8rApp").controller("registerCtrl",a),a.$inject=["authentication"],a.$inject=["$location","authentication"]}(),function(){function a(a,b){var c=this;c.pageHeader={title:"Sign in to Loc8r"},c.credentials={email:"",password:""},c.returnPage=a.search().page||"/",c.onSubmit=function(){return c.formError="",c.credentials.email&&c.credentials.password?void c.doLogin():(c.formError="All fields required, please try again",!1)},c.doLogin=function(){c.formError="",b.login(c.credentials).error(function(a){c.formError=a}).then(function(){a.search("page",null),a.path(c.returnPage)})}}angular.module("loc8rApp").controller("loginCtrl",a),a.$inject=["$location","authentication"]}(),function(){function a(){var a=this;a.pageHeader={title:"About Loc8r"},a.main={content:"Loc8r was created to help people find places to sit down and get a bit of work done.\n\n Lorem ipsum dolor sit amet, consectetur adipiscing elit."}}angular.module("loc8rApp").controller("aboutCtrl",a)}(),function(){function a(a,b,c,d,e){var f=this;f.locationid=a.locationid,f.pageHeader={title:"Location detail page",strapline:f.locationid},d.locationById(f.locationid).success(function(a){f.location=a,f.pageHeader={title:f.location.name}}).error(function(a){console.log(a)}),f.isLoggedIn=e.isLoggedIn(),f.currentPath=b.path(),f.popupReviewForm=function(){var a=c.open({templateUrl:"/reviewModal/reviewModal.view.html",controller:"reviewModalCtrl as vm",resolve:{locationData:function(){return{locationid:f.locationid,locationName:f.location.name}}}});a.result.then(function(a){f.location.reviews.push(a)})}}angular.module("loc8rApp").controller("locationDetailCtrl",a),a.$inject=["$routeParams","$location","$uibModal","loc8rData","authentication"]}(),function(){function a(a,b,c){var d=this;d.formData={},d.locationData=c,d.formError="",d.doAddReview=function(a,c){b.addReviewById(a,{rating:c.rating,text:c.reviewText}).success(function(a){d.modal.close(a)}).error(function(a){d.formError="Your review has not been saved, try again"})},d.onSubmit=function(){return d.formData.rating&&d.formData.reviewText?d.doAddReview(d.locationData.locationid,d.formData):d.formError="All fields are required, please try again.",!1},d.modal={close:function(b){a.close(b)},cancel:function(){a.dismiss("cancel")}}}angular.module("loc8rApp").controller("reviewModalCtrl",a),a.$inject=["$uibModalInstance","loc8rData","locationData"]}(),function(){function a(a,b){var c=function(b,c){return a.get("/api/locations?lng="+c+"&lat="+b+"&maxDistance=2000")},d=function(b){return a.get("/api/locations/"+b)},e=function(c,d){return a.post("/api/locations/"+c+"/reviews",d,{headers:{Authorization:"Bearer "+b.getToken()}})};return{locationByCoords:c,locationById:d,addReviewById:e}}angular.module("loc8rApp").service("loc8rData",a),a.$inject=["$http","authentication"]}(),function(){function a(a,b){var c=function(b){a.localStorage["loc8r-token"]=b},d=function(){return a.localStorage["loc8r-token"]},e=function(a){return b.post("/api/register",a).success(function(a){c(a.token)})},f=function(a){return b.post("/api/login",a).success(function(a){c(a.token)})},g=function(){a.localStorage.removeItem("loc8r-token")},h=function(){var b=d();if(b){var c=JSON.parse(a.atob(b.split(".")[1]));return c.exp>Date.now()/1e3}return!1},i=function(){if(h()){var b=d(),c=JSON.parse(a.atob(b.split(".")[1]));return{email:c.email,name:c.name}}};return{login:f,currentUser:i,isLoggedIn:h,logout:g,register:e,saveToken:c,getToken:d}}angular.module("loc8rApp").service("authentication",a),a.$inject=["$window","$http"]}(),function(){function a(){var a=function(a,b,c){navigator.geolocation?navigator.geolocation.getCurrentPosition(a,b):c()};return{getPosition:a}}angular.module("loc8rApp").service("geolocation",a)}(),angular.module("loc8rApp").filter("formatDistance",formatDistance);var _isNumeric=function(a){return!isNaN(parseFloat(a))&&isFinite(a)};!function(){function a(){return function(a){var b=a.replace(/\n/g,"<br/>");return b}}angular.module("loc8rApp").filter("addHtmlLineBreaks",a)}(),function(){function a(){return{restrict:"EA",scope:{thisRating:"=rating"},templateUrl:"/common/directives/ratingStars/ratingStars.template.html"}}angular.module("loc8rApp").directive("ratingStars",a)}(),function(){function a(){return{restrict:"EA",templateUrl:"/common/directives/footerGeneric/footerGeneric.view.html"}}angular.module("loc8rApp").directive("footerGeneric",a)}(),function(){function a(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.view.html",controller:"navigationCtrl as navvm"}}angular.module("loc8rApp").directive("navigation",a)}(),function(){function a(a,b){var c=this;c.currentPath=a.path(),c.isLoggedIn=b.isLoggedIn(),c.currentUser=b.currentUser(),c.logout=function(){b.logout(),a.path("/")}}angular.module("loc8rApp").controller("navigationCtrl",a),a.$inject=["$location","authentication"]}(),function(){function a(){return{restriction:"EA",scope:{content:"=content"},templateUrl:"/common/directives/pageHeader/pageHeader.view.html"}}angular.module("loc8rApp").directive("pageHeader",a)}();